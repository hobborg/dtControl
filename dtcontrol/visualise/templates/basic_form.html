<!DOCTYPE html>
<html lang="en">

<head>
    <style>
        .column   {float: left; width: 50%;height:80%;}
    </style>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <title>Controller Select</title>

</head>

<body>
    <h1>dtControl Frontend</h1>

    <div class="row">
        <div class="column">
            <form action="/midRoute" method="POST">
                <div>
                    <label for="controller">Choose a controller:</label>
                    <select id="controller" name="controller">
                    
                    </select>
                </div>
                <div>
                    <label for="config">Choose a config:</label>
                    <select id="config" name="config">
                    
                    </select>
                </div>
            
                <input type="submit">
              </form>
        </div>
        <div class="column">
            <div id="prop-list">

            </div>
        </div>
      </div>
  
  <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js"></script>
  <script type = "text/javascript">
    const app = document.getElementById('config');
    const app1 = document.getElementById('controller');

    var data1, data2;

    function postload() {
        const propDisplay = document.getElementById('prop-list');
        var defConf = (data2.presets.default);
        console.log("defConf is ",defConf);
        console.log(defConf.impurity);

        var iter =0;
        for(x in data2.presets){
            //loop over preset names
            for(y in defConf){
                //loop over properties
                const h1 = document.createElement('h4');
                var valu=defConf[y];
                if(data2.presets[x][y]){
                    valu = data2.presets[x][y];
                }
                h1.textContent = y + " -> " + valu;
                h1.setAttribute('class',x);
                if(iter!=0)
                    h1.style.display='none';
                propDisplay.appendChild(h1);
            }
            iter++;
        }

    }

    var xhr = new XMLHttpRequest();
    xhr.open('GET', './yml', true);
    xhr.onload = function () {
        data2 = JSON.parse(this.response);
        if (xhr.status >= 200 && xhr.status < 400) {
            for(x in data2.presets){
                const option = document.createElement('option');
                option.textContent = x;
                option.setAttribute('value',x);
                app.appendChild(option);
            }
            postload();

        } else {
            const errorMessage = document.createElement('marquee');
            errorMessage.textContent = `Gah, it's not working!`;
            app.appendChild(errorMessage);
        }
    }
    xhr.setRequestHeader('cache-control', 'no-cache, must-revalidate, post-check=0, pre-check=0');
    xhr.setRequestHeader('cache-control', 'max-age=0');
    xhr.setRequestHeader('expires', '0');
    xhr.setRequestHeader('expires', 'Tue, 01 Jan 1980 1:00:00 GMT');
    xhr.setRequestHeader('pragma', 'no-cache');
    xhr.send();

    var modl = new XMLHttpRequest();
    modl.open('GET', './examples', true);
    modl.onload = function () {
        data1 = JSON.parse(this.response);
        console.log("Raw data here");
        console.log(data1);
        console.log(data1.length);
        for(var i=0;i<data1.length;i++){
            const option = document.createElement('option');
            option.textContent = data1[i];
            option.setAttribute('value',data1[i]);
            app1.appendChild(option);
        }
    }
    modl.setRequestHeader('cache-control', 'no-cache, must-revalidate, post-check=0, pre-check=0');
    modl.setRequestHeader('cache-control', 'max-age=0');
    modl.setRequestHeader('expires', '0');
    modl.setRequestHeader('expires', 'Tue, 01 Jan 1980 1:00:00 GMT');
    modl.setRequestHeader('pragma', 'no-cache');
    modl.send();

    $("#config").change(function() {
        for(x in data2.presets){
            var dumm = "."+x;
            if ($(this).val() == x) {
                $(dumm).show();

            } else {
                $(dumm).hide();

            }
        }
    });
    $("#config").trigger("change");

    </script>


  
</body>

</html>