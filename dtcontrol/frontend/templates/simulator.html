{% extends 'base.html' %}

{% block hamburger %}
    <button id="navbar-hamburger" class="hamburger hamburger--arrow" type="button">
      <span class="hamburger-box">
        <span class="hamburger-inner"></span>
      </span>
    </button>
{% endblock %}

{% block content %}
    <!-- Modal that comes on clicking 'Simulate'-->
    <div class="modal fade" id="formSecondModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalCenterTitle"
         aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="exampleModalLongTitle">Enter system dynamics</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <!-- formSecond: Selects initial values for state variables -->
                <form id="formSecond">
                    <div class="modal-body">
                        <div id="dynamics-body" class="container">
                            <!-- Enter dynamics of the model -->
                            <div class="row-10 custom-file">
                                <div class="input-group mb-4">
                                    <div class="input-group-prepend">
                                        <span class="input-group-text" id="inputGroupFileAddon01">Upload</span>
                                    </div>
                                    <div class="custom-file">
                                        <input id="dynamics-file" type="file" name="file" class="custom-file-input">
                                        <label class="custom-file-label" for="dynamics-file">Choose file</label>
                                    </div>
                                </div>
                            </div>
                            <div class="row-10 mt-4">
                                <textarea id="dynamics-input" name="dynamics" rows="15" placeholder="Or enter dynamics here..."></textarea>
                            </div>
                        </div>
                        <div id="initial-values">
                            <div id="formSecondBody"></div>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" id="formSecond-next-button" class="btn btn-primary">Next</button>
                        <button type="button" id="formSecond-randomize-button" onclick="randomizeInputs()" class="btn btn-primary">
                            Randomise
                        </button>
                        <button type="submit" id="formSecond-submit-button" value="Submit" class="btn btn-primary">Submit</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Add all page content inside this div if you want the side nav to push page content to the right (not used if you only want the sidenav to sit on top of the page -->
    <div id="main" class="container-fluid simulator">

        <!-- Control buttons at the top-->
        <div class="col-lg-12">
            <div id="controls" class="row ml-2 mb-2">

<!--                <button id="openSecondFormButton" class="btn btn-primary" type="button">Simulate-->
<!--                </button>-->

<!--                <button id="openThirdFormButton" class="btn btn-primary" type="button"-->
<!--                        style="visibility: hidden;" onclick="expandAll(null);expandAll(null);collapseAll(null)">Edit-->
<!--                </button>-->

                <div id="operation-selector" class="btn-group btn-group-toggle" data-toggle="buttons">
                    <label class="btn btn-outline-primary">
                        <input type="radio" name="options" id="option-inspect" autocomplete="off">Inspect
                    </label>
                    <label class="btn btn-outline-primary">
                        <input type="radio" name="options" id="option-edit" autocomplete="off">Edit
                    </label>
                    <label class="btn btn-outline-primary">
                        <input type="radio" name="options" id="option-simulate" autocomplete="off">Simulate
                    </label>
                </div>

                <!-- The four player buttons -->
                <div class="btn-group btn-group-toggle ml-2 d-none" data-toggle="buttons" id="playerDiv"
                     style="z-index:5;">
                    <label class="btn btn-dark">
                        <input type="radio" name="player" id="play" autocomplete="off" value='0'> Play
                    </label>
                    <label class="btn btn-dark active">
                        <input type="radio" name="player" id="pause" autocomplete="off" value='1' checked> Pause
                    </label>
                    <label class="btn btn-dark">
                        <input type="radio" name="player" id="next" autocomplete="off" value='2'> Next
                    </label>
                    <label class="btn btn-dark">
                        <input type="radio" name="player" id="back" autocomplete="off" value='3'> Previous
                    </label>
                </div>

                <!-- Range slider for speed of simulation -->
                <div id="timeRangeContainer" class="d-none">
                    <label id="timeRangeLabel" class="ml-4 float-left" for="timeRange">Simulation Speed</label>
                    <input type="range" min="0.25" max="2" value="1" step="0.05" class="slider float-left" id="timeRange">
                    <div id="timeRate" class="ml-1 mr-4 float-left">1x</div>
                </div>

                <!-- Instep form -->
                <div id="instep" class="form-inline my-2 my-lg-0 d-none">
                    <input class="form-control w-50 mr-2" placeholder="# steps" aria-label="Number of steps"
                           type="number" id="steps" name="steps" min="1">
                    <button class="btn btn-dark my-2 my-sm-0">Step Forward</button>
                </div>

                <!-- Tree animation toggle -->
                <div id="animationDiv" class="btn-group-toggle d-none" data-toggle="buttons">
                    <label class="btn btn-outline-dark active" style="margin-left: 7px;">
                        <input id="animateTree" type="checkbox" checked autocomplete="off">Toggle Animation
                    </label>
                </div>


            </div>
        </div>

        <!-- Row in which tree and model visualisation cards get added -->
        <div id="mainRow1" class="row ml-2 mb-2" style="visibility: hidden;">
            <!-- Column for tree -->
            <div class="col-lg-12 mb-2" id="expandThisDiv">
                <div class="card shadow mb-4">
                    <div class="card-body">
                        <div class="container-fluid h-100">
                            <div class="row">
                                <button id="resetFocusButton" type="button" class="btn btn-dark mr-2" onclick="resetFocus('root')">Reset focus
                                </button>
                                <button id="expandAllButton" type="button" class="btn btn-dark mr-2"
                                        onclick="expandAll();">Expand all
                                </button>
                                <button id="collapseAllButton" type="button" class="btn btn-dark mr-2" onclick="collapseAll()">Collapse
                                    all
                                </button>
<!--                                <button id="selectRetrainNodeButton" type="button" class="btn btn-dark mr-2 active d-none" data-toggle="button" aria-pressed="true" autocomplete="off"-->
<!--                                        onclick="toggleNodeSelect();">Select Retrain Node-->
<!--                                </button>-->
                                <div id="nodeSelectInfo"></div>
                            </div>
                            <!-- Tree in this div -->
                            <div class="row" id="treeHere">

                            </div>

                            <div class="row mb-2 align-self-end">
                                <div class="col-auto mr-auto" style="font-size:0.9em">Click and drag to pan, scroll to zoom.</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Column for model visualisation -->
            <div class="col-lg-6 d-none" id="hideThisDiv">
                <div class="card shadow mb-4">
                    <div class="card-body">
                        <div style="text-align:center;">
                            <canvas id="cartCanvas" width="450" height="250"></canvas>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div id="mainRow-interactive" class="row ml-2 d-none">

            <div class="col-lg-6">
                <div class="card shadow mb-4">
                    <div class="card-body h-100">
                        <h4 class="card-title">Feature Specifications</h4>
                        <table id="feature-specification-table" class="table rounded">
                            <thead class="thead-light">
                            </thead>
                            <tbody></tbody>
                        </table>
                    </div>
                </div>

                <div class="card shadow mb-4">
                    <div class="card-body h-100">
                        <h4 class="card-title">Label Specifications</h4>
                        <table id="label-specification-table" class="table rounded">
                            <thead class="thead-light">
                            </thead>
                            <tbody></tbody>
                        </table>
                    </div>
                </div>

                <div class="card shadow mb-4">
                    <div class="card-body h-100">
                        <h4 class="card-title">Node Statistics</h4>
                        <table id="label-statistics-table" class="table rounded">
                            <thead class="thead-light">
                            </thead>
                            <tbody></tbody>
                        </table>
                    </div>
                </div>
            </div>
            <div class="col-lg-6">
                <div class="card shadow mb-4">
                    <div class="card-body h-100">
                        <h4 class="card-title">Predicate Collection</h4>
                        <table id="standard-predicates-collection" class="table rounded">
                            <thead class="thead-light">
                            </thead>
                            <tbody id="standard-predicates-tbody"></tbody>
                            <tbody id="recent-predicates-tbody"></tbody>
                        </table>
                        <div class="row justify-content-center">
                            <input id="add-predicate-button" class="btn btn-primary m-2" type="submit"
                                   value="Add Predicate" onclick="add_predicate()">
                            <input id="delete-predicate-button" class="btn btn-primary m-2" type="submit"
                                   value="Delete Predicate" onclick="remove_predicate()" disabled>
                        </div>
                    </div>
                </div>

                <div class="card shadow mb-4">
                    <div class="card-body h-100">
                        <h4 class="card-title">Instantiated Predicates</h4>
                        <table id="computed-predicates-table" class="table rounded">
                            <thead class="thead-light">
                            </thead>
                            <tbody></tbody>
                            <tbody></tbody>
                        </table>
                        <div class="row justify-content-center">
                            <input id="use-predicate-button" class="btn btn-primary m-2" type="submit"
                                   value="Use Predicate" onclick="use_predicate()">
                        </div>
                    </div>
                </div>


            </div>
        </div>

        <!-- Row for simulation table -->
        <div id="mainRow2" class="row ml-2 d-none">
            <div class="col-lg-12">
                <div class="card shadow mb-4">
                    <div class="card-body overflow-auto">
                        <div id="tableHere">
                            <!-- TODO T: maybe we can delete this? never used I think -->
                            <!-- Table in this div -->
                                <table id="simTable" class="table table-fixed rounded">
                                    <thead class="custom-thead">

                                    </thead>
                                    <tbody>
                                    <tr class="special">
                                        <td colspan="10" style="text-align: center">Start simulation to view trace here</td>
                                    </tr>
                                    </tbody>
                                </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Row for charts with two columns -->
        <div id="mainRow3" class="row ml-2 d-none">
            <div class="col-lg-6" id="chartsHere0">

            </div>

            <div class="col-lg-6" id="chartsHere1">

            </div>
        </div>

        <!-- Advanced options for retrain (moved here from base.html) -->
                <!-- Sidenav that is used for selecting controller, config and other fine tuning properties -->
        <div id="mySidenav" class="sidenav">
            <form id="formFirst">
                <div class="container">
        <!--            <div id="controllerSearchDirectoryRow" class="row">-->
        <!--                <div class="col-12">-->
        <!--                    <label for="controller-search-directory">Controller Directory</label>-->
        <!--                    <div class="input-group mb-3">-->
        <!--                        <input type="text" class="form-control" id="controller-search-directory" placeholder="Path to controller files"/>-->
        <!--                        <div class="input-group-append">-->
        <!--                            <button id="controller-directory-load" class="btn btn-secondary" style="height:calc(1.5em + .6rem + 2px);"-->
        <!--                                    type="button">Load-->
        <!--                            </button>-->
        <!--                        </div>-->
        <!--                    </div>-->
        <!--                </div>-->
        <!--            </div>-->
        <!--            <div id="controllerSelectRow" class="row mt-3">-->
        <!--                <div class="col-12">-->
        <!--                    <label for="controller">Controller</label>-->
        <!--                    <div class="select">-->
        <!--                        <select class="custom-select" id="controller" name="controller">-->
        <!--                            <option selected>Enter controller directory first</option>-->
        <!--                        </select>-->
        <!--                    </div>-->
        <!--                </div>-->
        <!--            </div>-->


                    <div id="presetSelectRow" class="row">
                        <div class="col-12">
                            <label for="config">Preset</label>
                            <div class="search_categories">
                                <div class="select">
                                    <select class="custom-select" id="config" name="config">
                                    </select>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div id="userPredicatesInputRow" class="row-10 mt-4 collapse">
                        <label for="userPredicatesInput">User Predicates</label>
                        <textarea id="userPredicatesInput" name="userPredicates" rows="3" style="width: 100%"
                                placeholder="Enter higher algebraic predicates here..."></textarea>
                    </div>

                    <!-- Divider -->

                    <div id="advanced-options-edit" class="row mt-3">
                        <div id="accordion">
                            <button id="accordionButton" type="button" class="btn btn-link collapsed" data-toggle="collapse"
                                    data-target="#advancedOptions">
                                <svg width="1em" height="1em" viewBox="0 0 16 16" class="bi bi-caret-right-fill"
                                    fill="currentColor"
                                    xmlns="http://www.w3.org/2000/svg">
                                    <path d="M12.14 8.753l-5.482 4.796c-.646.566-1.658.106-1.658-.753V3.204a1 1 0 0 1 1.659-.753l5.48 4.796a1 1 0 0 1 0 1.506z"></path>
                                </svg>
                                {#                        <svg width="1em" height="1em" viewBox="0 0 16 16" class="bi bi-caret-down-fill hidden"#}
                                {#                             fill="currentColor" xmlns="http://www.w3.org/2000/svg">#}
                                {#                            <path d="M7.247 11.14L2.451 5.658C1.885 5.013 2.345 4 3.204 4h9.592a1 1 0 0 1 .753 1.659l-4.796 5.48a1 1 0 0 1-1.506 0z"></path>#}
                                {#                        </svg>#}
                                <span>Show advanced options</span>
                            </button>
                        </div>
                    </div>

                    <div id="advancedOptions" class="collapse" data-parent="#accordion">

                        <div id ="fallbackSelectRow" class="row collapse">
                            <div class="col-12">
                                <label for="fallback">Fallback</label>
                                <div class="search_categories">
                                    <div class="select">
                                        <select class="custom-select" id="fallback" name="fallback">
                                        </select>
                                    </div>
                                </div>
                            </div>
                        </div>


                        <div class="row mt-3">
                            <div class="col-12">
                                <label for="determinize">Determinize</label>
                                <div class="search_categories">
                                    <div class="select">
                                        <select class="propList custom-select" id="determinize" name="determinize">
                                        </select>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div id="numericPredicatesSelectRow" class="row mt-3">
                            <div class="col-12 propList">
                                <label for="numeric-predicates">Numeric Predicates</label>
                                <div id="numeric-predicates"></div>
                                <!--div class="search_categories">
                                    <div class="select">
                                        <select class="propList custom-select" id="numeric-predicates" name="numeric-predicates"
                                                multiple>
                                        </select>
                                    </div>
                                </div-->
                            </div>
                        </div>

                        <div id="categoricalPredicatesSelectRow" class="row mt-3">
                            <div class="col-12 propList">
                                <label for="categorical-predicates">Categorical Predicates</label>
                                <div id="categorical-predicates"></div>
                            </div>
                        </div>

                        <!--div class="row mt-3">
                            <div class="col-12">
                                <label for="impurity">Impurity</label>
                                <div class="search_categories">
                                    <div class="select">
                                        <select class="propList custom-select" id="impurity" name="impurity">
                                        </select>
                                    </div>

                                </div>
                            </div>
                        </div-->
                        <div class="row mt-3">
                            <div class="col-12" id="tolerance-box">
                                <label for="tolerance">Tolerance</label>
                                <div>
                                    <!--input class="input-group-text" type="text" id="tolerance" name="tolerance"-->
                                    <input class="form-control" type="number" id="tolerance" value="0.00001" step="any">
                                </div>
                            </div>
                        </div>
                        <div class="row mt-3">
                            <div class="col-12">
                                <label for="safe-pruning">Safe-pruning</label>
                                <div class="search_categories">
                                    <div class="select">
                                        <select class="propList custom-select" name="safe-pruning" id="safe-pruning">
                                            <option value="true">True</option>
                                            <option value="false">False</option>
                                        </select>
                                    </div>

                                </div>
                            </div>
                        </div>
                    </div>
                    <button class="btn btn-primary btn-lg btn-block d-none" type="submit" name="retrain" style="margin-top: 1.25rem;"
                            id="retrain-button" disabled>Retrain from selected node
                    </button>
                    <button class="btn btn-primary btn-lg btn-block d-none" type="submit" name="interact" style="margin-top: 1.25rem;"
                            id="interactive-button" disabled>Start interactive tree builder from selected node
                    </button>
                </div>

            </form>


            <div id="inspect-field" class="container search-box row d-none">

                <div class="row mt-3">
                    <div class="col-12">

                        <div class="input-group mb-3">
                            <label for="inputGroupSelect02">Highlight the path to leaf nodes where</label>
                            <select class="custom-select" id="inputGroupSelect02">
                                <option selected value="all">all</option>
                                <option value="some" id="permissiveSomeHighlight" class="d-none">some</option>
                            </select>
                            <div class="input-group-append">
                                <label class="input-group-text" for="inputGroupSelect02" id="availableActions1">actions</label>
                            </div>
                        </div>


                        <label for="highlight-input">satisfy following constraint: </label>
                        <div>
                            <input class="input-group-text" type="text" id="highlight-input" name="highlight" value="a_0 >= 0">
                        </div>
                        <pre style="color:red;" id="highlight-error-message"></pre>



                    </div>


                    <div class="col-9">
                        <button id="highlight-form-button" type="button" class="btn btn-primary btn-block">Find</button>
                    </div>

                    <div class="col-2">
                        <button id="highlight-undo-button" type="button" class="btn btn-secondary" disabled="" onclick="highlight_undo_button()">
                            <i class="fa fa-undo"></i>
                        </button>
                    </div>
                </div>


                <div id="advanced-options-inspect" class="row mt-3">
                        <div id="accordion-inspect">
                            <button id="accordionButton-inspect" type="button" class="btn btn-link collapsed" data-toggle="collapse"
                                    data-target="#advancedHelp">
                                <svg width="1em" height="1em" viewBox="0 0 16 16" class="bi bi-caret-right-fill"
                                    fill="currentColor"
                                    xmlns="http://www.w3.org/2000/svg">
                                    <path d="M12.14 8.753l-5.482 4.796c-.646.566-1.658.106-1.658-.753V3.204a1 1 0 0 1 1.659-.753l5.48 4.796a1 1 0 0 1 0 1.506z"></path>
                                </svg>
                                <span>Show help</span>
                            </button>
                        </div>
                    </div>

                <div id="advancedHelp" class="collapse" data-parent="#accordion">


                    <div class="row mt-3">
                        <div class="col-12">

                            <p class="font-weight-bold">Help menu</p>
                            <p class="text-md-left">Within the current decision tree you can highlight various different paths to leaf nodes.</p>
                            <p class="font-weight-bold">Detailed statistic</p>
                            <ul>
                                <li>The current decision tree is:</li>
                                <pre id="permissiveHere"></pre>
                                <li>The action-dimension is:</li>
                                <pre id="dimensionHere"></pre>
                                <li>Available symbols to reference actions:</li>
                                <pre id="availableActions2"></pre>
                                <li>Available relations:</li>
                                <pre><=, >=, =</pre>
                                <li>Available boolean operations:</li>
                                <pre>&, and, |, or </pre>
                                <li>Example input:</li>
                                <pre id="exampleActionHere"></pre>
                            </ul>

                        </div>
                    </div>
                </div>
            </div>
        </div>

    </div>

    <script src="{{ url_for('static', filename='js/d3.v6.min.js') }}"></script>
    <script src="{{ url_for('static', filename='js/Chart.js') }}"></script>
    <script src="{{ url_for( 'static', filename='js/inspect.js' ) }}"></script>
<!--    <script src="{{ url_for('static', filename='js/d3.min.js') }}"></script>-->
<!--    <script src="{{ url_for('static', filename='js/d3.v4.js') }}"></script>-->
{% endblock %}